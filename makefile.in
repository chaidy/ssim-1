#!make
#******************************************************************************
#  Copyright (C) 2005-2007 TU Berlin, Felix Oum, Thomas Richter
#
#  This software is provided 'as-is', without any express or implied
#  warranty.  In no event will the authors be held liable for any damages
#  arising from the use of this software.
#
#  Permission is granted to anyone to use this software for any purpose,
#  including commercial applications, and to alter it and redistribute it
#  freely, subject to the following restrictions:
#
#  1. The origin of this software must not be misrepresented; you must not
#     claim that you wrote the original software. If you use this software
#     in a product, an acknowledgment in the product documentation would be
#     appreciated but is not required.
#  2. Altered source versions must be plainly marked as such, and must not be
#     misrepresented as being the original software.
#  3. This notice may not be removed or altered from any source distribution.
#
#	Felix Oum		Thomas Richter
#				thor@math.tu-berlin.de
#
#******************************************************************************
##
## $Id: makefile.in,v 1.11 2010-01-01 14:15:53 thor Exp $
##
## This is the meta-makefile included by all subdirectory
## makefiles. This file here is generated by autoconf, 
##
## *DO NOT EDIT, UNLESS THIS IS makefile.in*
##
## Any modifications should be made at makefile.in or
## Makefile.imco
##
########################################################################
##
## Some compiler settings.
##
CXX	= @CXX@
LD	= @CXX@
CC	= @CC@
MAKE	= make --no-print-directory
ECHO	= echo
AR	= ar
ARFLAGS	= -src
##
## $MAKEFILE is set by gmake itself.
##
## Generic options. Be ultra-paranoic here.
##
CFLAGS		= @PTHREAD_CFLAGS@ @CPPFLAGS@ -I.. -x c++ -c @WARNING_FLAGS@
##
## Generic linker flags
##
LDFLAGS		= @PTHREAD_CFLAGS@
##
## Additional libraries we need to add here
##
LDLIBS		= -lm @PTHREAD_LIBS@
##
##
## Flags for debugging code.
##
DEBUGGER	= @DEBUGGER_FLAGS@ -DDEBUG_LEVEL=2 -DCHECK_LEVEL=3
## Additional libs for debugging (e.g. -lefence)
DBLIBS		=
##
## Flags for optimized code.
##
OPTIMIZER	= -O3 -DDEBUG_LEVEL=0 -DCHECK_LEVEL=0 @OPTIMIZER_FLAGS@
##-fschedule-insns # These give "register spill" errors.
##-fschedule-insns2 #-fomit-frame-pointer breaks exception hand
##
## Flags for profiling code
##
PROFILER        = -pg @PROFILER_FLAGS@
## Additional flags for the linker when profiling.
LDPROF          = -pg
##
TOASM		= -S
##
## Installation specific issues
prefix          = @prefix@
exec_prefix     = @exec_prefix@
datadir         = @datadir@
BIN_PATH        = @bindir@
MAN_PATH        = @datadir@/man
##
########################################################################
##
## Project specific settings start here
##
#######################################################################
##
all		:	final
##
##
## Global settings, distribution, phony targets
##
.PHONY:	all debug profile final clean realclean %.final %.debug %.profile
##
########################################################################
########################################################################
##
## Subdirectories of this project (to be extended)
## Please edit HERE.
##
DIRS	= cmd global io std img ctrafo ssim vif wavelet
DIST	= ssimdiff
##
########################################################################
########################################################################
## Derived objects from the FILES define
##
INCLUDES	=	$(foreach file,$(FILES),$(file).hpp)    
SOURCES		=	$(foreach file,$(FILES),$(file).cpp)
OBJECTS		=	$(foreach file,$(FILES),$(file).o)
SUBLIBS		=	$(foreach dir,$(DIRS),$(dir)/$(dir).a)
##
#######################################################################
##
## Automatic dependecy checking
##
-include $(OBJECTS:.o=.d) .blank
##
%.d: %.cpp
	@ $(SHELL) -ec '$(CC) $(CFLAGS) -MM $< \
	| sed '\''s/\($*\)\.o[ :]*/\1.o $@ : /g'\'' > $@; \
	[ -s $@ ] || rm -f $@'
##
##
#######################################################################
##
## Compiler invocation rules follow
##
%.o: %.cpp %.hpp
	@ $(ECHO) "Compiling" $*.cpp
	@ $(CXX) $(CFLAGS) $(ADDFLAGS) $*.cpp

%.o: %.cpp
	@ $(ECHO) "Compiling" $*.cpp
	@ $(CXX) $(CFLAGS) $(ADDFLAGS) $*.cpp

%.s: %.cpp %.hpp
	@ $(ECHO) "Compiling" $*.cpp
	@ $(CXX) $(CFLAGS) $(ADDFLAGS) $(OPTIMIZER) $(TOASM) $*.cpp

%.s: %.cpp
	@ $(ECHO) "Compiling" $*.cpp
	@ $(CXX) $(CFLAGS) $(ADDFLAGS) $(OPTIMIZER) $(TOASM) $*.cpp

#######################################################################
##
## autoconf setup rules
config.h.in	:	configure.in
	autoheader
	@ touch config.h.in

configure	:	configure.in config.h.in
	autoconf
	@ touch configure

config.h	:	configure
	./configure
	@ touch config.h

$(MAKEFILE)	:	configure $(MAKEFILE).in
	./configure
	@ touch $(MAKEFILE)
##
##
#######################################################################
##
## Make rules come here
##
all		:	debug


##
## Meta-rule to create something in a sub-directory
##
$(DIRNAME).a	:	$(OBJECTS)
	@ $(AR) $(ARFLAGS) $(DIRNAME).a $(OBJECTS)

###########################################################################
##
## Rules for profile code, fully optimized
##

debug		:	$(foreach dir,$(DIRS),$(dir).debug)
	@ echo "Linking..."
	@ $(LD) $(LDFLAGS) $(LDLIBS) -Xlinker --start-group $(SUBLIBS) -Xlinker --end-group -o ssimdiff

%.debug		:
	@ $(MAKE) -C $* debug.sub

debug.sub	:
	@ $(MAKE) $(DIRNAME).a \
	ADDFLAGS="$(DEBUGGER)" ADDLIBS="$(DBLIBS)"

###########################################################################
##
## Rules for profile code, fully optimized
##

profile		:	$(foreach dir,$(DIRS),$(dir).profile)
	@ echo "Linking..."
	@ $(LD) $(LDFLAGS) $(LDLIBS) $(LDPROF) -Xlinker --start-group $(SUBLIBS) -Xlinker --end-group -o ssimdiff

%.profile	:
	@ $(MAKE) -C $* profile.sub

profile.sub	:
	@ $(MAKE) $(DIRNAME).a \
	ADDFLAGS="$(OPTIMIZER) $(PROFILER)" ADDLIBS="$(LDPROF)"

###########################################################################
##
## Rules for final code, fully optimized
##

final		:	$(foreach dir,$(DIRS),$(dir).final)
	@ echo "Linking..."
	@ $(LD) $(LDFLAGS) $(LDLIBS) -Xlinker --start-group $(SUBLIBS) -Xlinker --end-group -o ssimdiff

%.final		:
	@ $(MAKE) -C $* final.sub

final.sub	:
	@ $(MAKE) $(DIRNAME).a \
	ADDFLAGS="$(OPTIMIZER)" ADDLIBS=""

###########################################################################
##
## Rules for cleaning up
##

clean		:	$(foreach dir,$(DIRS),$(dir).clean)
	@ rm -rf *.dpi ssimdiff gmon.out core *~ *.a
	@ find -name "*.d" | xargs -r rm

%.clean		:
	@ $(MAKE) -C $* clean.sub

clean.sub	:
	@ rm -rf $(OBJECTS) $(OBJECTS:.o=.s) $(OBJECTS:.o=.d) $(OBJECTS:.o=.il)\
	*.dpi core *~ *.a
##
## also clean up the autoconf generated files.
realclean	:	clean
	@ rm -rf configure config.h config.h.in config.log config.status makefile

distrib		:
	make -f Makefile distrib

install		:	final
	cp ssimdiff ~/bin/wavelet/ssimdiff
##
##
#########################################################################
